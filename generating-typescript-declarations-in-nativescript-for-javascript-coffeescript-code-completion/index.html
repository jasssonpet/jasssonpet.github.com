<!DOCTYPE HTML> <html> <head> <meta charset="utf-8"> <title>Generating TypeScript Declarations in NativeScript for JavaScript/CoffeeScript Code Completion | Jason Zhekov&#39;s Blog</title> <meta name="author" content="Jason Zhekov"> <meta name="description" content="One thing that I like about NativeScript is the ease with which I am able to call native APIs. But sometimes the process of getting the language projections from Objective-C/Java to JavaScript right is somewhat tedious and error-prone. In this post I want to show you how the recent 1.4 release of NativeScript for iOS has made this experience a lot more pleasant."> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"> <meta property="og:title" content="Generating TypeScript Declarations in NativeScript for JavaScript/CoffeeScript Code Completion"> <meta property="og:site_name" content="Jason Zhekov&#39;s Blog"> <meta property="og:image" content="undefined"> <link href="/favicon.png" rel="icon"> <link rel="alternate" href="/atom.xml" title="Jason Zhekov&#39;s Blog" type="application/atom+xml"> <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"> <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> </head></html> <body> <header id="header" class="inner"><div class="alignleft"> <h1><a href="/">Jason Zhekov&#39;s Blog</a></h1> <h2><a href="/"></a></h2> </div> <nav id="main-nav" class="alignright"> <ul> <li><a href="/">Home</a></li> <li><a href="/archives">Archives</a></li> <li><a href="/about-me">About</a></li> </ul> <div class="clearfix"></div> </nav> <div class="clearfix"></div></header> <div id="content" class="inner"> <div id="main-col"><div id="wrapper"><article class="post"> <div class="post-content"> <header> <div class="icon"></div> <time datetime="2015-10-16T21:00:00.000Z"><a href="/generating-typescript-declarations-in-nativescript-for-javascript-coffeescript-code-completion/">2015-10-17</a></time> <h1 class="title">Generating TypeScript Declarations in NativeScript for JavaScript/CoffeeScript Code Completion</h1> </header> <div class="entry"> <p>One thing that I like about <a href="https://github.com/NativeScript/NativeScript">NativeScript</a> is the ease with which I am able to call native APIs. But sometimes the process of getting the language projections from <a href="http://docs.nativescript.org/runtimes/ios/marshalling/Marshalling-Overview">Objective-C</a>/<a href="http://docs.nativescript.org/runtimes/android/metadata/accessing-packages">Java</a> to JavaScript right is somewhat tedious and error-prone. In this post I want to show you how the recent <a href="https://github.com/NativeScript/ios-runtime/releases/tag/v1.4.0">1.4 release</a> of NativeScript for iOS has made this experience a lot more pleasant.</p> <a id="more"></a> <h2 id="Enter-TypeScript-Declarations"><a href="#Enter-TypeScript-Declarations" class="headerlink" title="Enter TypeScript Declarations"></a>Enter TypeScript Declarations</h2><p>What are those things are you asking? Here is an explanation straight from the <a href="http://www.typescriptlang.org/Handbook#modules-working-with-other-javascript-libraries">TypeScript docs</a>:</p> <blockquote> <p>To describe the shape of libraries not written in TypeScript, we need to declare the API that the library exposes. Because most JavaScript libraries expose only a few top-level objects, modules are a good way to represent them. We call declarations that don’t define an implementation “ambient”. Typically these are defined in <code>.d.ts</code> files. If you’re familiar with C/C++, you can think of these as <code>.h</code> files or <code>extern</code>.</p> </blockquote> <h2 id="Generating-TypeScript-Declarations-from-Native-APIs"><a href="#Generating-TypeScript-Declarations-from-Native-APIs" class="headerlink" title="Generating TypeScript Declarations from Native APIs"></a>Generating TypeScript Declarations from Native APIs</h2><p>Starting with version 1.4 of NativeScript for iOS, you are able to generate TypeScript declarations on the fly from Objective-C APIs. Executing the following command from the root of your NativeScript app will produce a <code>app/typings</code> folder with a <code>.d.ts</code> file for each iOS framework.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ TNS_TYPESCRIPT_DECLARATIONS_PATH=<span class="string">"<span class="variable">$(pwd)</span>/app/typings"</span> tns build ios</div></pre></td></tr></table></figure></p> <blockquote> <p><strong>How this works:</strong> Here we are declaring the <code>TNS_TYPESCRIPT_DECLARATIONS_PATH</code> <a href="https://wiki.archlinux.org/index.php/Environment_variables">environment variable</a> which flows down to <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/xcodebuild.1.html"><code>xcodebuild</code></a> which subsequently triggers the NativeScript metadata generator build step. Because of this you are able to effortlessly generate TypeScript declarations for any newly added third party framework or CocoaPod. Android support is <a href="https://github.com/NativeScript/android-dts-generator">under active development</a>, but for now you can use the pre-generated <a href="https://github.com/NativeScript/NativeScript/blob/master/android17.d.ts">android.d.ts</a> file.</p> </blockquote> <h2 id="TypeScript-Declaration-Example"><a href="#TypeScript-Declaration-Example" class="headerlink" title="TypeScript Declaration Example"></a>TypeScript Declaration Example</h2><p> Here is a simple example. Somewhere in the iOS SDK there is a <code>&lt;UIKit/UIApplication.h&gt;</code> header declaring the <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIKitFunctionReference/#//apple_ref/c/func/UIApplicationMain"><code>UIApplicationMain</code></a> function:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="built_in">UIApplicationMain</span>(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[], <span class="built_in">NSString</span>* principalClassName, <span class="built_in">NSString</span>* delegateClassName);</div></pre></td></tr></table></figure></p> <p>After building your app in the aforementioned way, there should be a <code>objc!UIKit.d.ts</code> file with the same function declared, but this time with a TypeScript signature:<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">UIApplicationMain</span>(<span class="params">argc: <span class="built_in">number</span>, argv: interop.Reference&lt;<span class="built_in">string</span>&gt;, principalClassName: <span class="built_in">string</span>, delegateClassName: <span class="built_in">string</span></span>): <span class="title">number</span></span>;</div></pre></td></tr></table></figure></p> <blockquote> <p><strong>Note:</strong> Apple recently introduced Objective-C generics in Xcode 7. With a recent pull request in the iOS metadata generator (<a href="https://github.com/NativeScript/ios-runtime/pull/341">#341</a>), those are expressed in the generated <code>.d.ts</code> files as well. For example the <code>+ (NSArray&lt;NSBundle*&gt;*)allBundles</code> Objective-C method is projected as <code>static allBundles(): NSArray&lt;NSBundle&gt;</code> in TypeScript.</p> </blockquote> <h2 id="Using-TypeScript-Declarations-Outside-TypeScript"><a href="#Using-TypeScript-Declarations-Outside-TypeScript" class="headerlink" title="Using TypeScript Declarations Outside TypeScript"></a>Using TypeScript Declarations Outside TypeScript</h2><p><strong>This is all great, you say, but I <em>hate</em> TypeScript.</strong> I totally understand you and agree with you, but fear not - there is a way to combine the best of both worlds. You can use most of the benefits of native code completion not only in TypeScript, but also in JavaScript (or CoffeeScript).</p> <p>One way of doing so is by using <a href="https://www.jetbrains.com/webstorm/">WebStorm</a>. It is a world-renowned IDE for web development and a personal favorite of mine. It works on Windows, Mac OS or Linux and has an unlimited trial with 30 minute session limitation or a completely free <a href="http://confluence.jetbrains.com/display/WI/WebStorm+EAP">EAP (Early Access Program) version</a>. It has support for JavaScript, CoffeeScript and TypeScript. But even more - it has cross-language code analysis, which is why it is best for our scenario. It can pick up the metadata from the TypeScript declarations and provide intelligent code completion in all other languages:</p> <p>Here is how it looks with CoffeeScript:<br><img src="/generating-typescript-declarations-in-nativescript-for-javascript-coffeescript-code-completion/code-completion.png" alt="CoffeeScript code completion from TypeScript declarations" title="CoffeeScript code completion from TypeScript declarations"><br>We are getting some nice fuzzy code completion on the <a href="https://developer.apple.com/library/prerelease/ios//documentation/CoreFoundation/Reference/CFDateFormatterRef/index.html#//apple_ref/doc/constant_group/Date_Formatter_Styles"><code>CFDateFormatterStyle</code></a> enum.</p> <h2 id="Moving-Forward-JSDoc-Documentation-for-Native-Frameworks"><a href="#Moving-Forward-JSDoc-Documentation-for-Native-Frameworks" class="headerlink" title="Moving Forward - JSDoc Documentation for Native Frameworks"></a>Moving Forward - JSDoc Documentation for Native Frameworks</h2><p>In the next release we would like to make the experience even smoother. We are working on optionally including documentation from <a href="https://kapeli.com/dash_guide">Xcode docsets</a> (or <a href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/HeaderDoc/tags/tags.html">HeaderDoc</a> tags for third-party frameworks) in the generated TypeScript declarations.</p> <p>Again, this is not limited to WebStorm only, but here is how the documentation for the <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIKitFunctionReference/#//apple_ref/c/func/UIApplicationMain"><code>UIApplicationMain</code></a> function looks like with the WebStorm <a href="http://usejsdoc.org/">JSDoc</a> visualizer in CoffeeScript:<br><img src="/generating-typescript-declarations-in-nativescript-for-javascript-coffeescript-code-completion/docs.png" alt="CoffeeScript documentation for UIApplicationMain" title="CoffeeScript documentation for UIApplicationMain"></p> <p>Tell us what you think about this feature in the related issue - <a href="https://github.com/NativeScript/ios-runtime/issues/353">#353</a>.</p> <p>There are some <a href="https://github.com/NativeScript/ios-runtime/issues/282">known issues</a> with generating TypeScript declarations for now, but if you find any new bugs in the generated TypeScript declarations we will be glad to fix them if you <a href="https://github.com/NativeScript/ios-runtime/issues/new">report them on GitHub</a>.</p> <p><strong>UPDATE 1:</strong> You can also use the <a href="https://www.npmjs.com/package/nativescript-dev-babel">Babel</a>, <a href="https://www.npmjs.com/package/nativescript-dev-coffeescript">CoffeeScript</a> and <a href="https://www.npmjs.com/package/nativescript-dev-typescript">TypeScript</a> NativeScript CLI plugins to ease the configuration of the the transpilers in your NativeScript project.</p> <p><strong>UPDATE 2:</strong> JSDoc comments for native APIs are now implemented - <a href="https://github.com/NativeScript/ios-metadata-generator/pull/37">#37</a>.</p> </div> <footer> <div class="clearfix"></div> </footer> </div> </article></div></div> </div> <footer id="footer" class="inner"><div class="alignleft"> &copy; 2016 Jason Zhekov </div> <div class="clearfix"></div></footer> </body> 